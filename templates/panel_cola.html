<script>
  async function cargarCola() {
    try {
      const response = await fetch("/api/cola_lavado");
      const data = await response.json();
      const tbodyCola = document.getElementById("tabla-cola");
      const tbodyProceso = document.getElementById("tabla-proceso");
      tbodyCola.innerHTML = "";
      tbodyProceso.innerHTML = "";

      let i = 1, j = 1;

      data.forEach(item => {
        const estado = (item.estado || "").toLowerCase();  // asegura que no sea undefined
        const codigo = item.codigo_vehiculo || "N/A";
        const clasificacion = item.clasificacion || "-";
        const asignado = item.asignado_a || "-";
        const fecha = item.fecha || "-";

        if (estado === "en_proceso" && asignado !== "-") {
          const fila = document.createElement("tr");
          fila.innerHTML = `
            <td>${j++}</td>
            <td class="status-PRO"><strong>${codigo}</strong></td>
            <td>${clasificacion}</td>
            <td>${asignado}</td>
            <td>${fecha}</td>
          `;
          tbodyProceso.appendChild(fila);
        } else {
          const fila = document.createElement("tr");
          fila.innerHTML = `
            <td>${i++}</td>
            <td class="status-EN"><strong>${codigo}</strong></td>
            <td>${clasificacion}</td>
            <td>${fecha}</td>
          `;
          tbodyCola.appendChild(fila);
        }
      });

    } catch (error) {
      console.error("‚ùå Error al cargar la cola:", error);
      document.getElementById("tabla-cola").innerHTML = `<tr><td colspan="4">Error al cargar datos</td></tr>`;
      document.getElementById("tabla-proceso").innerHTML = `<tr><td colspan="5">Error al cargar datos</td></tr>`;
    }
  }

  cargarCola();
  setInterval(cargarCola, 30000);
  document.getElementById("anio-actual").textContent = new Date().getFullYear();
</script>
